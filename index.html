<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat Ele & Ela</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a2d0b5d6d3.js" crossorigin="anonymous"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to right, #ffe6e6, #ffe6f0);
    }
    body.fundoAtivo {
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
    }
    .login-box {
      background-image: url('background_login.png');
      background-size: cover;
      background-position: center;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .login-overlay {
      background-color: rgba(0, 0, 0, 0.6);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      color: #fff;
      width: 90%;
      max-width: 320px;
    }
    .login-overlay i { font-size: 36px; margin-bottom: 10px; }
    .login-overlay h2 { margin-bottom: 20px; }
    .login-overlay input { padding: 10px; width: 100%; border-radius: 8px; margin-bottom: 15px; font-size: 16px; }
    .login-overlay button {
      padding: 10px;
      width: 100%;
      border: none;
      background-color: #D6336C;
      color: white;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .container {
      background: rgba(255, 255, 255, 0.9);
      margin: 5% auto;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(255, 192, 203, 0.8);
      display: none;
    }
    .chat-mensajes {
      height: 250px;
      overflow-y: auto;
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
    }
    .chat input[type="text"] {
      width: 70%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .chat button {
      padding: 10px;
      background-color: #D6336C;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .upload-container button {
      background-color: #D6336C;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
    }
    .progress-bar {
      width: 100%;
      background: #eee;
      border-radius: 20px;
      margin-top: 10px;
      display: none;
    }
    .progress {
      height: 12px;
      background: #D6336C;
      width: 0;
      border-radius: 20px;
      transition: width 0.3s ease;
    }
    .hora {
      font-size: 12px;
      color: gray;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="login-box" id="loginBox">
    <div class="login-overlay">
      <i class="fas fa-lock"></i>
      <h2>Quem √© voc√™?</h2>
      <input type="password" id="senha" placeholder="Digite sua senha" onkeypress="if(event.key==='Enter')verificarSenha()">
      <button onclick="verificarSenha()">Entrar</button>
      <p class="error" id="erroMsg" style="color: red; display:none;">Senha incorreta!</p>
    </div>
  </div>

  <div class="container" id="conteudo">
    <h1 style="text-align: center; color: #D6336C;">Mais um dia sem voc√™</h1>
    <div class="chat">
      <div class="chat-mensajes" id="chatMensagens"></div>
      <input type="text" id="chatInput" placeholder="Escreva uma mensagem...">
      <button id="enviarBtn">Enviar</button>
      <div class="upload-container">
        <input type="file" id="imagemInput" accept="image/*" capture="environment" style="display: none;">
        <button id="cameraBtn" title="Enviar foto da c√¢mera">
          <i class="fas fa-camera"></i>
        </button>
        <div class="progress-bar" id="progressBar"><div class="progress" id="progress"></div></div>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDfBpJ-5DhknC9QRdSj8O1ShdJwBiL8284",
      authDomain: "chat-ele-ela.firebaseapp.com",
      projectId: "chat-ele-ela",
      storageBucket: "chat-ele-ela.firebasestorage.app",
      messagingSenderId: "1019858101951",
      appId: "1:1019858101951:web:5fba5a102d67d9009c880a"
    };

    const clientId = "9c2d72d1a0c3b0b";
    let usuario = localStorage.getItem("usuario");

    const chatMensagens = document.getElementById("chatMensagens");
    const chatInput = document.getElementById("chatInput");

    function verificarSenha() {
      const senha = document.getElementById("senha").value;
      if (senha === "14141516") usuario = "Ele";
      else if (senha === "170125") usuario = "Ela";
      else if (senha === "4444") return window.location.href = "https://blaze.bet.br/";
      else return document.getElementById("erroMsg").style.display = "block";

      localStorage.setItem("usuario", usuario);
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("conteudo").style.display = "block";
      document.body.classList.add("fundoAtivo");
      iniciarChat();
    }

    async function iniciarChat() {
      const db = firebase.firestore();
      db.collection("chat").orderBy("timestamp").onSnapshot((snapshot) => {
        chatMensagens.innerHTML = "";
        snapshot.forEach((doc) => {
          const data = doc.data();
          const emoji = data.usuario === "Ele" ? "üíô" : "üíñ";
          const hora = data.timestamp?.toDate().toLocaleTimeString().slice(0,5) || "‚è≥";

          const msg = document.createElement("div");
          if (data.imagemUrl) {
            msg.innerHTML = `<strong>${emoji} ${data.usuario}:</strong> <br><img src="${data.imagemUrl}" style="width: 100px; border-radius: 10px;"> <span class="hora">${hora}</span>`;
          } else {
            msg.innerHTML = `<strong>${emoji} ${data.usuario}:</strong> ${data.mensagem} <span class="hora">${hora}</span>`;
          }
          chatMensagens.appendChild(msg);
        });
        chatMensagens.scrollTop = chatMensagens.scrollHeight;
      });

      document.getElementById("enviarBtn").onclick = async () => {
        const texto = chatInput.value.trim();
        if (texto !== "") {
          await db.collection("chat").add({ usuario, mensagem: texto, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
          chatInput.value = "";
        }
      };

      document.getElementById("cameraBtn").onclick = () => document.getElementById("imagemInput").click();
      document.getElementById("imagemInput").onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const progressBar = document.getElementById("progressBar");
        const progress = document.getElementById("progress");
        progressBar.style.display = "block";

        const form = new FormData();
        form.append("image", file);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "https://api.imgur.com/3/image");
        xhr.setRequestHeader("Authorization", `Client-ID ${clientId}`);

        xhr.upload.onprogress = function (e) {
          if (e.lengthComputable) {
            const percent = (e.loaded / e.total) * 100;
            progress.style.width = percent + "%";
          }
        };

        xhr.onload = async function () {
          progressBar.style.display = "none";
          const response = JSON.parse(xhr.responseText);
          const imageUrl = response.data.link;
          await db.collection("chat").add({ usuario, imagemUrl: imageUrl, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
        };

        xhr.send(form);
      };
    }
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</body>
</html>
